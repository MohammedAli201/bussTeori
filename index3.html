<!DOCTYPE html>
<html lang="nb">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Bussf√∏rer ‚Äì Eksamen & √òving (Delvalg)</title>
<style>
  :root{
    --primary:#1a56db;--primary-dark:#1e3a8a;--primary-light:#3b82f6;
    --success:#10b981;--danger:#ef4444;--warning:#f59e0b;
    --light:#f8fafc;--dark:#0f172a;--gray:#64748b;--gray-light:#e2e8f0;
    --card-bg:#fff;--body-bg:#f1f5f9;--border:#cbd5e1;--shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06)
  }
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%;font-family:system-ui,-apple-system,'Segoe UI',Roboto,sans-serif;line-height:1.6;color:var(--dark);background:var(--body-bg)}
  body{display:flex;flex-direction:column}
  header{background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:#fff;padding:1rem 1.25rem;box-shadow:var(--shadow);position:sticky;top:0;z-index:10}
  .header{max-width:1100px;margin:0 auto;display:flex;gap:.75rem;align-items:center;justify-content:space-between;flex-wrap:wrap}
  h1{font-size:1.2rem}
  main{flex:1;max-width:1100px;margin:0 auto;padding:1rem}
  .card{background:var(--card-bg);border:1px solid var(--border);border-radius:12px;box-shadow:var(--shadow);padding:1rem;margin-bottom:1rem}
  .card-title{font-size:1.1rem;font-weight:800;margin-bottom:.25rem}
  .card-subtitle{color:var(--gray);font-size:.92rem}
  .row{display:flex;gap:.8rem;flex-wrap:wrap;margin:.75rem 0}
  .form-group{min-width:220px;flex:1}
  label{display:block;margin-bottom:.35rem;font-weight:700}
  select,button{width:100%;padding:.75rem 1rem;border:1px solid var(--border);border-radius:10px;font-size:1rem}
  select:focus,button:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgba(59,130,246,.2)}
  .primary{background:var(--primary);color:#fff;border:none}
  .primary:hover{background:var(--primary-dark)}
  .secondary{background:var(--gray-light)}
  .success{background:var(--success);color:#fff;border:none}
  .danger{background:var(--danger);color:#fff;border:none}
  .hidden{display:none!important}
  .toolbar{display:flex;gap:.5rem;flex-wrap:wrap}
  .progress-info{display:flex;justify-content:space-between;color:var(--gray);font-size:.95rem;margin-bottom:.5rem}
  .progress-bar{height:8px;background:var(--gray-light);border-radius:999px;overflow:hidden}
  .progress-fill{height:100%;background:linear-gradient(90deg,var(--primary),var(--primary-light));transition:width .25s}
  .qwrap{display:flex;gap:1rem;flex-wrap:wrap}
  .question-text{font-size:1.05rem;font-weight:700;margin:.25rem 0 .5rem}
  .q-img{max-width:280px;max-height:220px;border-radius:10px;border:1px solid var(--border)}
  .options-list{list-style:none;display:flex;flex-direction:column;gap:.6rem}
  .option{display:flex;gap:.6rem;border:1px solid var(--border);border-radius:10px;padding:.75rem;cursor:pointer}
  .option:hover{background:#f8fafc}
  .option.correct{background:rgba(16,185,129,.1);border-color:var(--success);color:var(--success)}
  .option.wrong{background:rgba(239,68,68,.1);border-color:var(--danger);color:var(--danger)}
  .explanation{margin-top:.75rem;padding:.75rem;background:#f0f9ff;border-left:4px solid var(--primary);border-radius:0 10px 10px 0}
  .actions{display:flex;gap:.6rem;flex-wrap:wrap;margin-top:.8rem}
  .save-hint{margin-top:.35rem;font-size:.9rem;color:#1e3a8a;opacity:0;transition:opacity .2s;display:flex;align-items:center;gap:.4rem}
  .save-hint.show{opacity:1}
  .dot{width:.55rem;height:.55rem;border-radius:999px;background:var(--success)}
  .score-circle{width:120px;height:120px;border-radius:50%;background:conic-gradient(var(--success) 0% var(--p), var(--gray-light) var(--p) 100%);display:flex;align-items:center;justify-content:center;margin:0 auto 1rem}
  .score-inner{width:90px;height:90px;border-radius:50%;background:#fff;display:flex;flex-direction:column;align-items:center;justify-content:center;font-weight:800}
  .stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:.6rem;margin:1rem 0}
  .stat-card{background:#fff;border:1px solid var(--border);border-radius:10px;padding:1rem;text-align:center}
  .review-item{border:1px solid var(--border);border-radius:10px;padding:1rem;margin:.6rem 0;background:#fff}
  .review-answers{display:grid;grid-template-columns:1fr 1fr;gap:.6rem}
  @media (max-width:850px){.review-answers{grid-template-columns:1fr}}
  .review-answer{padding:.75rem;border-radius:8px;border-left:4px solid var(--border)}
  .review-answer.correct{background:rgba(16,185,129,.08);border-left-color:var(--success)}
  .review-answer.incorrect{background:rgba(239,68,68,.08);border-left-color:var(--danger)}
</style>
</head>
<body>
<header>
  <div class="header">
    <div style="display:flex;gap:.6rem;align-items:center"><span style="font-size:1.4rem">üöå</span><h1>Bussf√∏rer ‚Äì Eksamen & √òving</h1></div>
    <div class="toolbar">
      <button id="btnReset" class="danger">Nullstill lagring</button>
    </div>
  </div>
</header>

<main>
  <section id="setup" class="card">
    <div class="card-title">Oppsett</div>
    <div class="card-subtitle">Velg <b>del</b>, antall sp√∏rsm√•l og modus. (Alt lagres automatisk ‚Äì du kan fortsette senere.)</div>

    <div class="row">
      <div class="form-group">
        <label for="dataset">Velg del</label>
        <select id="dataset"></select>
        <small id="dsInfo" class="card-subtitle"></small>
      </div>
      <div class="form-group">
        <label for="qcount">Antall sp√∏rsm√•l fra valgt del</label>
        <select id="qcount"></select>
      </div>
      <div class="form-group">
        <label for="mode">Modus</label>
        <select id="mode">
          <option value="practice" selected>√òving (fasit underveis)</option>
          <option value="exam">Eksamen (fasit til slutt)</option>
        </select>
      </div>
    </div>

    <div class="actions">
      <button id="start" class="primary">Start</button>
      <button id="resume" class="secondary hidden">Fortsett lagret √∏ving</button>
    </div>
  </section>

  <section id="player" class="card hidden">
    <div class="progress-info"><span id="qpos">Sp√∏rsm√•l 1 av 0</span><span id="cat">Kategori: ‚Äî</span></div>
    <div class="progress-bar"><div id="bar" class="progress-fill" style="width:0%"></div></div>
    <div class="progress-info"><span>Riktig: <b id="ok">0</b></span><span>Feil: <b id="no">0</b></span></div>

    <div class="qwrap">
      <div style="flex:2 1 440px">
        <div class="question-text" id="qtext">‚Ä¶</div>
        <ul id="opts" class="options-list"></ul>
        <div id="saveHint" class="save-hint"><span class="dot"></span><span>Valg lagret</span></div>
        <div id="explain" class="explanation hidden"><strong>Forklaring:</strong> <span id="explainText"></span></div>
      </div>
      <div style="flex:1 1 280px">
        <img id="qimg" class="q-img hidden" alt="Bilde for sp√∏rsm√•let">
      </div>
    </div>

    <div class="actions">
      <button id="btnPrev" class="secondary">Forrige</button>
      <button id="btnSvar" class="primary">Sjekk svar</button>
      <button id="btnNext" class="secondary">Neste</button>
      <button id="btnFinish" class="success">Fullf√∏r</button>
    </div>
  </section>

  <section id="result" class="card hidden">
    <div style="text-align:center">
      <div class="score-circle" id="scoreCircle" style="--p:0%"><div class="score-inner"><div id="scorePercent">0%</div><small>Resultat</small></div></div>
      <div class="card-title">√òving fullf√∏rt</div>
      <div id="resText" class="card-subtitle">Du fikk 0 riktige av 0 med fasit (0%).</div>
    </div>
    <div class="stats">
      <div class="stat-card"><div class="stat-value" id="statCorrect">0</div><div class="stat-label">Riktige</div></div>
      <div class="stat-card"><div class="stat-value" id="statIncorrect">0</div><div class="stat-label">Feil</div></div>
      <div class="stat-card"><div class="stat-value" id="statUnanswered">0</div><div class="stat-label">Ikke besvart</div></div>
    </div>
    <div class="actions">
      <button id="btnReview" class="primary">Gjennomgang (vis fasit)</button>
      <button id="btnNew" class="success">Start ny √∏ving</button>
    </div>
    <div id="review" style="margin-top:.8rem"></div>
  </section>
</main>

<script>
/**************
  DATASETT-ST√òTTE
  - Forvent globale arrayer:
    * QUESTIONS_ALL (alle / del 1)
    * QUESTIONS_DEL2 (valgfritt ‚Äì f.eks. 39 sp√∏rsm√•l)
    * QUESTIONS_DEL3, QUESTIONS_DEL4 ... (valgfritt)
  - Appen finner dem automatisk om de finnes p√• window.
**************/
const QUESTIONS_DEL2 = [
  // 1‚Äì8
  {category:"F√∏rerett", question:"Hva er riktig om gyldighet for f√∏rerett i klasse D?", options:["Gjelder ogs√• for lett motorsykkel","Gjelder ogs√• motorvogn i klasse C","Gjelder ogs√• for trekking av tilhenger med tillatt totalvekt over 750 kg","Gjelder ogs√• for leddbuss"], answer:3, explanation:"Klasse D gjelder buss, inkludert leddbuss. Tilhenger >750 kg krever DE."},
  {category:"Forsikring", question:"Hvilken forsikring er p√•budt for buss i persontransport?", options:["Trafikkforsikring (ansvarforsikring)","Delkasko","Kaskoforsikring","Tabbeforsikring"], answer:0, explanation:"Ansvarsforsikring er lovp√•lagt for registrerte kj√∏ret√∏y."},

  {category:"Pliktmessig avhold", question:"Hva er riktig om pliktmessig avhold?", options:["Gjelder for alle yrkessj√•f√∏rer","Gjelder bare de som utf√∏rer persontransport","En bussj√•f√∏r kan ha inntil 0,5 promille","Gjelder kun for sj√•f√∏r av buss med over 16 sitteplasser"], answer:0, explanation:"Alkoholforbud 8 timer f√∏r og under tjeneste."},
  
  {category:"Forsikring", question:"Hvilken forsikring m√• busselskapet ha for √• f√• dekket skade p√• egne kj√∏ret√∏y?", options:["Trafikkforsikring (ansvarsforsikring)","Kaskoforsikring","L√∏s√∏rforsikring","Tabbeforsikring"], answer:1, explanation:"Kasko dekker skader p√• eget kj√∏ret√∏y."},
  
  
  {category:"Periodisk kontroll", question:"Hvor ofte skal en buss fremstilles til periodisk kontroll (EU-kontroll)?", options:["Hvert halv√•r","Hvert √•r","Hvert annet √•r","Hvert fjerde √•r"], answer:1, explanation:"Buss EU-kontrolleres normalt hvert annet √•r."},
  
  {category:"Dokument", question:"Hvilken dokument m√• f√∏reren ha med seg i tillegg til f√∏rerkort og vognkort n√•r det kj√∏res turbuss?", options:["Kj√∏reseddel","Sonetaksttabel","Ruteplan","Vegliste"], answer:0, explanation:"Kj√∏reseddel kreves ved persontransport mot vederlag."},

  {category:"Fysikk/Brems", question:"En fullastet buss vil f√•...", options:["Kortere bremselengde enn en personbil i samme fart","Lengre bremselengde enn en personbil i samme fart","Like lang bremselengde som en minibuss i samme fart","Like lang bremselengde som en minibuss uansett fart"], answer:1, explanation:"St√∏rre masse gir lengre bremselengde."},
  {category:"Trafikksikkerhet", question:"Hvordan skal bussf√∏reren forholde seg til syklister langs vegen?", options:["Holde avstand p√• omtrent 1 meter","Kj√∏re raskt forbi for √• redusere risiko","Det m√• varsles med lydsignal for √• bedre bussens fremkommelighet","Tilpasse fart og avstand"], answer:3, explanation:"Avpass fart og hold god avstand for sikker forbikj√∏ring."},

  // 9‚Äì16
  {category:"Dekk", question:"I sommerhalv√•ret skal dekk p√• buss ha m√∏nsterdybde p√• minst...", options:["0.6","1.6","2.6","3.0"], answer:1, explanation:"Minimum 1,6 mm i sommerhalv√•ret."},
  {category:"Motor", question:"Hva kan v√¶re √•rsaken til at r√∏yken fra en dieselmotor er svart?", options:["Lekkasje i eksosanlegget","Luft kan ha kommet inn i drivstoffanlegget","Kj√∏levann kan ha kommet inn i sylinderene","Luftfilteret kan v√¶re tett"], answer:3, explanation:"Tett luftfilter ‚Üí lite luft ‚Üí ufullstendig forbrenning."},
  
  {category:"Trykkluft", question:"Hvordan kan du kontrollere frostvernet (luftt√∏rken) i et bremseanlegg om trykkluft virker?", options:["Pumpe bremsepedalen og kontrollere trykkfall","Kontrollere kompressorens ladekapasitet","Kontrollere at varsellampe for lav frostvern virker","Tappe trykklufttanken for √• se at det ikke kommer vann ut"], answer:3, explanation:"Tapping av tank: det skal ikke komme vann."},
  
  {category:"Vedlikehold", question:"Etter hjulskifte skal hjulmutterne etter ca. 50 kilometers kj√∏ring...", options:["Ettertrekkes med riktig moment","Ettertrekkes med s√• stor kraft som mulig","L√•se seg selv","Kontrolleres med autorisert verksted"], answer:0, explanation:"Ettertrekk med korrekt moment etter kort kj√∏ring."},
  {category:"Utstyr", question:"Du kj√∏rer buss i januar m√•ned. Hvor mange kjettinger skal minst v√¶re med i bussen?", options:["1","2","3","4"], answer:2, explanation:"Minst 3 kjettinger i vinterperiode."},

  {category:"(Data)", question:"N√•r skal denne GT13287 bussen, EU-kontrolleres?", options:["Januar","August","November","Mai"], answer:2, explanation:"Buss med kjennemerke GT13287 har siste siffer 7, og if√∏lge reglene for EU-kontroll (periodisk kj√∏ret√∏ykontroll) betyr det at kontrollfristen er i november."},
  {category:"Piggdekk", question:"Piggdekk p√• buss...", options:["Er bare tillatt √• bruke p√• innerhjulene i tvillingmontering","M√• brukes p√• alle hjul","Kan brukes p√• forhjulene selv om bakhjulene ikke har piggdekk","Gir fritak for √• medbringe kjettinger"], answer:2, explanation:"Forhjul kan ha pigg selv om bak ikke har pigg."},
  {category:"F√∏rstehjelp", question:"F√∏rstehjelpsskrin i buss skal v√¶re plassert...", options:["Synlig og lett tilgjengelig","I bagasjerommet","Ved hver seterad","Ved n√∏dutgangene"], answer:0, explanation:"Skal v√¶re lett tilgjengelig."},






  // 17‚Äì24
  {category:"Servostyring", question:"Hvordan kontrollerer du om servostyringen virker?", options:["Ved √• se at det ikke er lekkasje ved p√•fyllingen","Ved √• kjenne at rattet blir lettere √• dreie n√•r jeg stopper motoren","Ved √• kjenne at rattet blir lettere √• dreie n√•r jeg starter motoren","Ved √• se at det bobler i servo beholderen n√•r det dreies p√• rattet"], answer:2, explanation:"Rattet blir lettere n√•r motor/servopumpe starter."},
  {category:"Elektrisk anlegg", question:"Sikringene i det elektriske anlegg skal sikre...", options:["At brann ikke oppst√•r","Batteriene mot overladning","Lysp√¶rene mot forh√∏yet spenning","At det er str√∏m p√• batteriene"], answer:0, explanation:"Beskytter mot overbelastning/varmeutvikling (brann)."},
  {category:"Utstyr", question:"Du m√• bruke refleksvest n√•r du legger p√• kjetting. Hvordan skal vesten oppbevares?", options:["I lasterommet","Sammen med kjettingene","Lett tilgjengelig for f√∏rer","I bussens sikringsskap"], answer:2, explanation:"Skal v√¶re lett tilgjengelig fra f√∏rerplass."},
  {category:"Bremser", question:"Du kan forhindre at bremsebelegget glaseres ved √•...", options:["Bruke motorbremsen sammen med fotbremsen","Bruke bremsene svakt og minst mulig","La bremsene bli skikkelig varme av og til","Bremse kraftig av og til"], answer:3, explanation:"Kraftige bremsinger av og til kan ‚Äòrense‚Äô belegget."},
  {category:"Kj√∏re-/Hviletid", question:"Hvor lang tid kan en bussf√∏rer maksimalt kj√∏re f√∏r den p√•lagte 45-minutters pausen m√• tas?", options:["5.5 timer","5 timer","4.5 timer","4 timer"], answer:2, explanation:"Maks 4,5 t f√∏r 45 min pause."},
  {category:"Dokument", question:"Du skal kj√∏re buss i ruta. Hva m√• du ta med deg?", options:["Reservehjul","Servicebok","Instruksjonsbok","Kj√∏reseddel"], answer:3, explanation:"Kj√∏reseddel ved rutekj√∏ring."},
  {category:"Fartsskriver", question:"Du skal kj√∏re buss med digital fartsskriver. Hva m√• du ha med deg?", options:["Bedriftskort","Sj√•f√∏rkort","Reserve Sj√•f√∏rkort","Bankkort"], answer:1, explanation:"Gyldig sj√•f√∏rkort."},
  {category:"Fartsskriver", question:"Hva skal den digitale fartsskriveren blant annet registrere?", options:["Antall passasjerer","Akselerasjon/Retardasjon","Ferie","Hviletid"], answer:3, explanation:"Registrerer bl.a. hviletid/pauser/kj√∏retid."},

  // 25‚Äì32
  {category:"Vekt/Overlast", question:"Hvilken p√•stand om overlast er riktig?", options:["Buss er fritatt for overlastgebyr","Det brukes lavere gebyrsatser enn for lastbiler","Det kan kreves at passasjerer m√• forlate bussen","Frimargin er 1500 kg p√• bakaksel for buss som har luftfj√¶ring"], answer:2, explanation:"Passasjerer kan m√•tte g√• av ved overlast."},
 
  {category:"Fartsskriver", question:"Hva skal du gj√∏re n√•r fartsskriveren slutter √• fungere?", options:["Opps√∏ke et godkjent verksted og f√• den reparert","Opps√∏ke en trafikkstasjon og f√• den reparert","Opps√∏ke en politistasjon for dispensasjon","Opps√∏ke en tollstasjon for dispensasjon"], answer:0, explanation:"Reparer snarest hos godkjent verksted ‚Äì manuell registrering midlertidig."},
  {category:"(Data)", question:"Hvor mange passasjerer er bussen maksimalt godkjent for?", options:["59 passasjerer","97 passasjerer","145 passasjerer","147 passasjerer"], answer:3, explanation:"Store leddbusser og bybusser, som den i oppgaven, er ofte godkjent for opptil 145 passasjerer (inkludert b√•de sittende og st√•ende)", image:"images/uten_nav_questions/uten_nav_image_seq_27.png"},




  {category:"(Data/BK)", question:"Du skal kj√∏re denne bussen p√• f√∏lgende strekning i finnmark fylke Rv. 94 Skaidi x E6 ‚Äì Hammerfest kai. Hva blir st√∏rste tillatte nyttelast p√• foraksel?", options:["1940 kg","2015 kg","4840 kg","7100 kg"], answer:0, explanation:"Den st√∏rste tillatte nyttelasten p√• forakselen er 1 940 kg",image:"images/uten_nav_questions/uten_nav_image_ques_28.png"},
  {category:"(Data/BK)", question:"Du skal kj√∏re f√∏lgende strekning i rogaland fylke: Rv. 13 Hogstadkrossen ‚Äì Ims ‚Äì H√∏le Krk X Kv. Hva er st√∏rste tillatte boggilast p√• buss med luftfj√¶ring?", options:["11 500 kg","12 000 kg","14 000 kg","16 000 kg"], answer:2, explanation:"Strekningen Rv. 13 Hogstadkrossen ‚Äì Ims ‚Äì H√∏le kirke har lavere b√¶reevne (BK8/BKT8).For buss med luftfj√¶ring tillates inntil 14 000 kg boggilast "},
  {category:"(Data/BK)", question:"Du skal kj√∏re denne bussen til Hordaland fylka p√• E134 fra Haukeli X E134 ‚Äì Midtl√¶ger X E134. Hva er riktig?", options:["St√∏rste tillatte totalvekt er 19 000 kg","St√∏rste tillatte kj√∏ret√∏ylengde for buss er 12,40 m","N√•r bussen er fullastet, kan hver passasjer m/bagasje veie 100 kg","Bussen kan ha 51 passasjerer"], answer:1, explanation:"St√∏rste tillatte kj√∏ret√∏ylengde for buss p√• strekningen er 12,40 meter .",image:"images/uten_nav_questions/ uten_nav_que_30.png"},
  {category:"Boggi/BK10", question:"Du kj√∏rer buss med luftfj√¶ring p√• en Bk 10 veg. Hva er st√∏rste tillatte boggilast n√•r akselavstanden i boggien er 136 cm?", options:["12 tonn","14 tonn","16 tonn","18 tonn"], answer:3, explanation:"st√∏rste tillatte boggilast 18 tonn ."},
  {category:"Boggi/BK10", question:"Du kj√∏rer buss med luftfj√¶ring p√• en BK  10 veg. Hva er st√∏rste tillatte boggilast n√•r akselavstanden i boggien er 139 cm?", options:["16 tonn","18 tonn","19 tonn","20 tonn"], answer:2, explanation:"P√• BK10-veier kan buss med luftfj√¶ring og styrende boggi ha inntil 19 tonn boggilast, selv om akselavstanden er 1,39 m.."},



  // 33‚Äì40 (skilt og kollektiv)
  {category:"Trafikkskilt", question:"Hva betyr skiltet?", options:["Sidevind","Bru","Tunnel","Flyplass"], answer:0, explanation:"", image:"images/uten_nav_questions/uten_nav_quest_33.png"},
  {category:"(Data/H√∏yde)", question:"Du kj√∏rer buss med h√∏yde 3,19 meter. Hvor kan du kj√∏re?", options:["Mot E18","Mot Gj√∏vik","Mot E6","Mot sentralest"], answer:1, explanation:".", image:"images/uten_nav_questions/uten_nav_34.png" },
  {category:"Trafikkskilt", question:"Hva betyr skiltet?", options:["Parkeringsplass for lastbiler","Parkeringsplass tillatt for alle kj√∏ret√∏y","Omkj√∏ringsrute for store kj√∏ret√∏y","Vegvisning til n√¶rmest terminal"], answer:2, explanation:"", image:"images/uten_nav_questions/uten_nav_35.png"},
  {category:"Kollektivfelt", question:"Du som kj√∏rer buss kan bruke feltet helt til h√∏yre. Hvilke andre kj√∏ret√∏y kan bruke det?", options:["Taxi med inntil 5 sitteplasser","Sykkel","Lastbil","Traktor"], answer:1, explanation:"Sykkel kan normalt ogs√• bruke kollektivfelt (lokale unntak kan finnes).", image:"images/uten_nav_questions/uten_nav_ques_36.png"},
 
  {category:"Kj√∏ret√∏ygeometri", question:"N√•r kan langt overheng p√• buss skape problemer?", options:["Ved kj√∏ring p√• rett veg","Ved rygging rett bakover","Ved svinging i trange kryss","Ved skift av kj√∏refelt"], answer:2, explanation:"Overhenget sveiper i trange svinger."},

  {category:"Vegmerking", question:"Hvilken informasjon gir vegoppmerkingen deg n√•r du kj√∏rer buss?", options:["Den viser at det kun er ett kj√∏refelt","Den varsler om svak vegskulder","Det kan bli liten plass n√•r du m√∏ter andre kj√∏ret√∏y","Den viser at du snart kommer til tettbygde str√∏k"], answer:2, explanation:"Markerer at m√∏teplass kan bli trangt.",image:"images/uten_nav_questions/uten_nav_ques_38.png"},




  
  
  {category:"Kollektivsignal", question:"Du kj√∏rer buss i kollektivfelt og kommer til signalregulert kryss. Den hvite pilen betyr det samme som...", options:["R√∏d og gul p√•","Gr√∏nn p√•","Gul p√•","R√∏d p√•"], answer:1, explanation:"Hvit pil/S = gr√∏nt for buss i kollektivfelt.",image:"images/uten_nav_questions/uten_nav_ques_39.png" },




  {category:"Kollektivsignal", question:"Du kj√∏rer buss i kollektivfeltet som er lengst til h√∏yre hva betyr lyskombinasjonen?", options:["Kan ikke kj√∏re fordi det er hvit ‚ÄúS‚Äù","Kan svinge til h√∏yre pga gr√∏nt lys","Kan kj√∏re rett frem pga gr√∏nt lys","Kan ikke kj√∏re pga hvit ‚ÄúS‚Äù"], answer:3, explanation:"Trenger data (det faktiske signalbildet/banevalg).", image:"images/uten_nav_questions/uten_nav_ques_40.png"},  





  // 41‚Äì45
  {category:"Framkommelighet", question:"God framkommelighet med buss krever...", options:["Godt samarbeid med andre trafikanter","H√∏y gjennomsnittsfart","Liten avstand til forankj√∏rende","At vegens skulder benyttes"], answer:0, explanation:"Samspill gir flyt og sikkerhet."},
  {category:"Trafikksikkerhet", question:"Hvordan skal en bussf√∏rer forholde seg ved forbikj√∏ring av syklister p√• landevegen?", options:["Holde en meters avstand","Holde bussen innenfor eget kj√∏refelt","Avpasse farten og holde god avstand","Avpasse farten etter fartsgrensen p√• stedet"], answer:2, explanation:"Fart ned og god sideavstand."},
  
  {category:"Fysikk/Brems", question:"I en gitt hastighet er bremselengden ca. 25 meter. Hvor lang blir den n√•r hastigheten dobles?", options:["Ca. 50 meter","Ca. 75 meter","Ca. 100 meter","Ca. 125 meter"], answer:2, explanation:"Bremselengde ‚àù v¬≤ ‚Üí 25 m blir ~100 m."},
  
  {category:"Lysf√∏ring", question:"Du kj√∏rer i m√∏rket og har m√∏tende trafikk. Hvilket lys skal v√¶re tent n√•r du st√•r i ro p√• en bussholdeplass?", options:["T√•kelys","Fjernlys","Parkeringslys","N√¶rlys"], answer:2, explanation:"Parklys ved stans."},
  {category:"Ansvar", question:"Hvem er ansvarlig for at vikepliktbestemmelsene ved rygging overholdes?", options:["Bussf√∏reren","Busselskapet","Passasjeren","Hjelpemannen"], answer:0, explanation:"F√∏rer har ansvaret uansett."},
  {category:"Milj√∏", question:"Hvordan kan milj√∏et spares ved kj√∏ring med buss?", options:["Unng√• bruk av hjelpbremser","Kj√∏r p√• h√∏yt turtall","Tidlig fartsreduksjon for √• f√• flere girskift","F√¶rrest mulig girskifter"], answer:3, explanation:"Jevn kj√∏ring og f√¶rre girskift reduserer forbruk."}
];
// DEMO: Bruker QUESTIONS_ALL fra siden din.
// Hvis du legger til flere i egen <script>-tag f√∏r denne, vil de dukke opp automatisk.

(function(){
  const detected=[];
  if(Array.isArray(window.QUESTIONS_ALL)) detected.push({key:'all', name:`Del 1 (Alle)`, arr: window.QUESTIONS_ALL});
  for(let i=2;i<=10;i++){
    const arr = window[`QUESTIONS_DEL${i}`];
    if(Array.isArray(arr)) detected.push({key:`del${i}`, name:`Del ${i}`, arr});
  }
  // Hvis ingen andre er oppdaget, lag en tom Del 2-plassholder for brukeren
  if(!detected.find(d=>d.key==='del2')){
    const arr = Array.isArray(window.QUESTIONS_DEL2)? window.QUESTIONS_DEL2 : [];
    detected.push({key:'del2', name:`Del 2${arr.length?``:` (ingen sp√∏rsm√•l lastet)`}`, arr});
  }
  window.__DATASETS__ = detected; // tilgjengelig for debugging
})();

const SAVE_KEY="bus_exam_nb_v2";
let mode="practice", pool=[], idx=0, answered=[], correct=[], revealed=[], currentDsIndex=0;

const els={
  setup:document.getElementById('setup'), player:document.getElementById('player'), result:document.getElementById('result'),
  start:document.getElementById('start'), resume:document.getElementById('resume'),
  dataset:document.getElementById('dataset'), dsInfo:document.getElementById('dsInfo'),
  qcount:document.getElementById('qcount'), mode:document.getElementById('mode'),
  qpos:document.getElementById('qpos'), cat:document.getElementById('cat'),
  bar:document.getElementById('bar'), ok:document.getElementById('ok'), no:document.getElementById('no'),
  qtext:document.getElementById('qtext'), opts:document.getElementById('opts'), qimg:document.getElementById('qimg'),
  explain:document.getElementById('explain'), explainText:document.getElementById('explainText'),
  btnPrev:document.getElementById('btnPrev'), btnNext:document.getElementById('btnNext'),
  btnSvar:document.getElementById('btnSvar'), btnFinish:document.getElementById('btnFinish'),
  scoreCircle:document.getElementById('scoreCircle'), scorePercent:document.getElementById('scorePercent'),
  resText:document.getElementById('resText'), statCorrect:document.getElementById('statCorrect'),
  statIncorrect:document.getElementById('statIncorrect'), statUnanswered:document.getElementById('statUnanswered'),
  review:document.getElementById('review'), btnReview:document.getElementById('btnReview'), btnNew:document.getElementById('btnNew'),
  btnReset:document.getElementById('btnReset'), saveHint:document.getElementById('saveHint')
};

const shuffle=a=>{for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a};
const sample=(arr,n)=> n>=arr.length?arr.slice():shuffle(arr.slice()).slice(0,n);
const fmt=x=> new Intl.NumberFormat('nb-NO').format(x);
const isGraded=i=> typeof(pool[i]?.answer)==='number';

function dataset(){ return window.__DATASETS__?.[currentDsIndex] || {key:'all',name:'Del 1',arr:(window.QUESTIONS_ALL||[])}; }

function populateDatasets(){
  const list = window.__DATASETS__ || [];
  els.dataset.innerHTML = list.map((d,i)=>`<option value="${i}">${d.name} (${d.arr.length})</option>`).join('');
  els.dataset.value = "0";
  updateQcount();
}

function updateQcount(){
  const ds = dataset();
  const n = ds.arr.length;
  const opts=[];
  const marks = [10,20,30];
  marks.forEach(m=>{ if(n>=m) opts.push(`<option value="${m}">F√∏rste ${m}</option>`); });
  opts.push(`<option value="${n}" selected>Alle (${n})</option>`);
  els.qcount.innerHTML = opts.join('');
  els.dsInfo.textContent = `Valgt: ${ds.name} ‚Äì ${n} sp√∏rsm√•l`;
}

function save(){ localStorage.setItem(SAVE_KEY, JSON.stringify({mode,pool,idx,answered,correct,revealed,currentDsIndex})); }
function load(){ try{const o=JSON.parse(localStorage.getItem(SAVE_KEY)||"null"); if(o&&Array.isArray(o.pool)){mode=o.mode;pool=o.pool;idx=Math.min(Math.max(0,o.idx|0),(o.pool.length||1)-1);answered=o.answered||[];correct=o.correct||[];revealed=o.revealed||[];currentDsIndex=o.currentDsIndex||0;return true}}catch(e){} return false; }

let hintTimer=null;
function showHint(msg="Valg lagret"){ els.saveHint.innerHTML=`<span class="dot"></span><span>${msg}</span>`; els.saveHint.classList.add('show'); clearTimeout(hintTimer); hintTimer=setTimeout(()=>els.saveHint.classList.remove('show'),1000); }
function getSel(){ const r=els.opts.querySelector('input:checked'); return r?parseInt(r.value):null; }

function render(){
  const total=pool.length;
  if(!total){ els.qtext.textContent="Ingen sp√∏rsm√•l i valgt del"; els.opts.innerHTML=""; els.explain.classList.add('hidden'); els.qimg.classList.add('hidden'); return; }
  const q=pool[idx];
  els.qpos.textContent=`Sp√∏rsm√•l ${idx+1} av ${total}`;
  els.cat.textContent=`Kategori: ${q.category||"‚Äî"}`;
  els.qtext.textContent=q.question||"";
  els.opts.innerHTML="";
  els.explain.classList.add('hidden'); els.explainText.textContent=q.explanation||"";
  if(q.image){ els.qimg.src=q.image; els.qimg.classList.remove('hidden'); } else { els.qimg.classList.add('hidden'); els.qimg.removeAttribute('src'); }

  (q.options||[]).forEach((t,i)=>{
    const li=document.createElement('li'); li.className='option';
    li.innerHTML=`<input type="radio" name="alt" value="${i}" id="opt${i}"><label for="opt${i}">${t}</label>`;
    const input=li.querySelector('input');
    input.addEventListener('change',()=>{
      answered[idx]=i; correct[idx]=(typeof q.answer==='number' && i===q.answer);
      const done=answered.filter(v=>v!=null).length;
      const okCount=correct.filter(Boolean).length;
      const incorrectCount=answered.filter((v,k)=> v!=null && isGraded(k) && !correct[k]).length;
      els.ok.textContent=fmt(okCount); els.no.textContent=fmt(incorrectCount);
      els.bar.style.width=Math.round((done/total)*100)+'%'; save(); showHint();
    });
    li.addEventListener('click',()=>{ input.checked=true; input.dispatchEvent(new Event('change',{bubbles:true})); });
    els.opts.appendChild(li);
  });

  const sel=answered[idx];
  if(sel!=null){ const r=els.opts.querySelectorAll('input')[sel]; if(r) r.checked=true; if(revealed[idx]) showSolution(); }

  const done=answered.filter(v=>v!=null).length;
  const okCount=correct.filter(Boolean).length;
  const incorrectCount=answered.filter((v,k)=> v!=null && isGraded(k) && !correct[k]).length;
  els.ok.textContent=fmt(okCount); els.no.textContent=fmt(incorrectCount);
  els.bar.style.width=Math.round((done/total)*100)+'%';
  els.btnSvar.disabled=(mode==='exam');
}

function showSolution(){
  const q=pool[idx]; const sel=getSel();
  els.opts.querySelectorAll('.option').forEach((li,j)=>{
    li.classList.remove('correct','wrong');
    if(typeof q.answer==='number'){ if(j===q.answer) li.classList.add('correct'); if(sel!=null && j===sel && sel!==q.answer) li.classList.add('wrong'); }
  });
  if(q.explanation && q.explanation.trim()) els.explain.classList.remove('hidden');
  revealed[idx]=true;
}

function go(step){ idx=Math.min(Math.max(0, idx+step), pool.length-1); render(); save(); }

function buildReview(){
  els.review.innerHTML='<div class="card-title">Gjennomgang (fasit)</div>';
  pool.forEach((q,i)=>{
    const sel=answered[i]; const hasFasit=(typeof q.answer==='number'); const isAnswered=sel!=null; const isCorrect=!!correct[i];
    const wrap=document.createElement('div'); wrap.className='review-item';
    const head=document.createElement('div'); head.style.display='flex'; head.style.gap='.5rem'; head.style.flexWrap='wrap'; head.style.marginBottom='.4rem';
    head.innerHTML=`<span>#${i+1}</span> <span>${q.category||'‚Äî'}</span> <span>${isAnswered?(hasFasit?(isCorrect?'Riktig':'Feil'):'Besvart'):'Ikke besvart'}</span>`;
    wrap.appendChild(head);
    const qt=document.createElement('div'); qt.style.fontWeight='700'; qt.style.marginBottom='.35rem'; qt.textContent=q.question||''; wrap.appendChild(qt);
    const grid=document.createElement('div'); grid.className='review-answers';
    const ua=document.createElement('div'); ua.className='review-answer '+(isAnswered?(hasFasit?(isCorrect?'correct':'incorrect'):''):''); ua.innerHTML=`<strong>Ditt svar:</strong><br>${isAnswered?(q.options?.[sel]??'‚Äî'):'‚Äî'}`;
    const fa=document.createElement('div'); fa.className='review-answer correct'; fa.innerHTML=`<strong>Fasit:</strong><br>${hasFasit?(q.options?.[q.answer]??'‚Äî'):'‚Äî'}`;
    grid.append(ua,fa); wrap.appendChild(grid);
    if(q.explanation && q.explanation.trim()){ const ex=document.createElement('div'); ex.className='explanation'; ex.innerHTML=`<strong>Forklaring:</strong> ${q.explanation}`; wrap.appendChild(ex); }
    els.review.appendChild(wrap);
  });
}

function finish(){
  const sel=getSel(); if(sel!=null){ const q=pool[idx]; answered[idx]=sel; correct[idx]=(typeof q.answer==='number' && sel===q.answer); }
  if(mode==='exam'){ revealed=revealed.map(()=>true); }
  const totalGraded=pool.filter(q=>typeof q.answer==='number').length;
  const okCnt=correct.filter(Boolean).length;
  const incorrectGraded=answered.filter((v,i)=> v!=null && isGraded(i) && !correct[i]).length;
  const rate= totalGraded? Math.round((okCnt/totalGraded)*100):0;
  els.resText.textContent=`Du fikk ${okCnt} riktige av ${totalGraded} med fasit (${rate}%).`;
  els.scoreCircle.style.setProperty('--p', `${rate}%`);
  els.scorePercent.textContent=`${rate}%`;
  els.statCorrect.textContent=okCnt; els.statIncorrect.textContent=incorrectGraded; els.statUnanswered.textContent=answered.filter(v=>v==null).length;
  els.player.classList.add('hidden'); els.result.classList.remove('hidden');
  buildReview(); save();
}

function changeDataset(){
  currentDsIndex = parseInt(els.dataset.value,10) || 0;
  updateQcount();
}

function init(){
  populateDatasets();
  els.dataset.addEventListener('change', changeDataset);

  document.getElementById('start').addEventListener('click',()=>{
    const ds = dataset();
    let N=parseInt(els.qcount.value,10); if(!Number.isFinite(N)||N<1) N=ds.arr.length;
    mode=els.mode.value;
    // Del-valg: Bruk de N f√∏rste sp√∏rsm√•lene i valgt del (IKKE tilfeldig for eksamensoppsett pr del)
    pool = ds.arr.slice(0, N);
    answered=new Array(pool.length).fill(null);
    correct=new Array(pool.length).fill(false);
    revealed=new Array(pool.length).fill(false);
    idx=0;
    els.setup.classList.add('hidden'); els.player.classList.remove('hidden'); els.result.classList.add('hidden');
    render(); save();
  });
  els.btnPrev.addEventListener('click',()=>go(-1));
  els.btnNext.addEventListener('click',()=>go(+1));
  els.btnSvar.addEventListener('click',()=>{ const sel=getSel(); if(sel==null) return alert("Velg et alternativ f√∏rst"); if(!revealed[idx]) showSolution(); render(); save(); showHint("Svar registrert"); });
  els.btnFinish.addEventListener('click',finish);
  document.getElementById('btnReview').addEventListener('click',()=>{ els.player.classList.add('hidden'); els.result.classList.remove('hidden'); revealed=revealed.map(()=>true); buildReview(); save(); });
  document.getElementById('btnNew').addEventListener('click',()=>{ els.result.classList.add('hidden'); els.setup.classList.remove('hidden'); });
  document.getElementById('btnReset').addEventListener('click',()=>{ localStorage.removeItem(SAVE_KEY); alert("Lagring slettet"); location.reload(); });

  if(load()){
    // reload dataset-list UI, set selected index
    populateDatasets();
    els.dataset.value = String(currentDsIndex);
    updateQcount();
    els.resume.classList.remove('hidden');
    els.resume.addEventListener('click',()=>{ els.setup.classList.add('hidden'); els.player.classList.remove('hidden'); render(); });
  }
}

document.addEventListener('DOMContentLoaded', init);
</script>

<!--
BRUK:
- Legg QUESTIONS_ALL og ev. QUESTIONS_DEL2 (39 spm), QUESTIONS_DEL3 ... i et <script> f√∏r denne filen.
- Appen finner dem automatisk og viser i "Velg del".
- N√•r du velger en del, settes "Antall sp√∏rsm√•l" til Alle (kan ogs√• velge F√∏rste 10/20/30 hvis del er lang nok).
- Start bruker rekkef√∏lgen i datasettene (ikke tilfeldig), slik at Del 1 alltid er (1‚Äì45), Del 2 er (1‚Äì39) osv.
-->
</body>
</html>
